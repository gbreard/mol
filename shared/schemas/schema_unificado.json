{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Schema Unificado de Ofertas Laborales",
  "description": "Esquema común para ofertas de todas las fuentes de scraping",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "source",
    "source_id",
    "titulo",
    "empresa",
    "url_oferta",
    "fecha_extraccion"
  ],
  "properties": {

    "_metadata": {
      "type": "object",
      "description": "Metadatos de la oferta",
      "properties": {
        "source": {
          "type": "string",
          "enum": ["zonajobs", "bumeran", "computrabajo", "linkedin", "indeed", "otro"],
          "description": "Fuente de la oferta"
        },
        "source_id": {
          "type": "string",
          "description": "ID único en la fuente original"
        },
        "unified_id": {
          "type": "string",
          "description": "ID único universal (source_sourceId)"
        },
        "url_oferta": {
          "type": "string",
          "format": "uri",
          "description": "URL de la oferta"
        },
        "fecha_extraccion": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp de cuándo se extrajo"
        },
        "version_scraper": {
          "type": "string",
          "description": "Versión del scraper utilizado"
        }
      },
      "required": ["source", "source_id", "url_oferta", "fecha_extraccion"]
    },

    "informacion_basica": {
      "type": "object",
      "description": "Información básica de la oferta",
      "properties": {
        "titulo": {
          "type": "string",
          "description": "Título de la oferta"
        },
        "titulo_normalizado": {
          "type": "string",
          "description": "Título normalizado para matching"
        },
        "empresa": {
          "type": "string",
          "description": "Nombre de la empresa"
        },
        "empresa_id": {
          "type": "string",
          "description": "ID de la empresa en la fuente"
        },
        "descripcion": {
          "type": "string",
          "description": "Descripción completa de la oferta"
        },
        "descripcion_limpia": {
          "type": "string",
          "description": "Descripción sin HTML y procesada"
        }
      },
      "required": ["titulo", "empresa"]
    },

    "ubicacion": {
      "type": "object",
      "description": "Información de ubicación",
      "properties": {
        "pais": {
          "type": "string",
          "description": "País"
        },
        "provincia": {
          "type": "string",
          "description": "Provincia/Estado"
        },
        "ciudad": {
          "type": "string",
          "description": "Ciudad"
        },
        "ubicacion_raw": {
          "type": "string",
          "description": "Ubicación tal como aparece en la fuente"
        },
        "codigo_postal": {
          "type": "string",
          "description": "Código postal si está disponible"
        }
      }
    },

    "modalidad": {
      "type": "object",
      "description": "Modalidad de trabajo",
      "properties": {
        "tipo_trabajo": {
          "type": "string",
          "enum": ["full_time", "part_time", "freelance", "temporario", "pasantia", "otro", null],
          "description": "Tipo de trabajo"
        },
        "modalidad_trabajo": {
          "type": "string",
          "enum": ["presencial", "remoto", "hibrido", null],
          "description": "Modalidad (presencial/remoto/híbrido)"
        },
        "tipo_trabajo_raw": {
          "type": "string",
          "description": "Tipo de trabajo tal como aparece en la fuente"
        },
        "modalidad_raw": {
          "type": "string",
          "description": "Modalidad tal como aparece en la fuente"
        }
      }
    },

    "fechas": {
      "type": "object",
      "description": "Fechas relevantes",
      "properties": {
        "fecha_publicacion": {
          "type": "string",
          "format": "date-time",
          "description": "Fecha de publicación"
        },
        "fecha_modificacion": {
          "type": "string",
          "format": "date-time",
          "description": "Fecha de última modificación"
        },
        "fecha_cierre": {
          "type": "string",
          "format": "date-time",
          "description": "Fecha de cierre si está disponible"
        },
        "fecha_publicacion_raw": {
          "type": "string",
          "description": "Fecha tal como aparece en la fuente"
        }
      }
    },

    "requisitos": {
      "type": "object",
      "description": "Requisitos del puesto",
      "properties": {
        "experiencia_minima": {
          "type": "string",
          "description": "Experiencia mínima requerida"
        },
        "nivel_educativo": {
          "type": "string",
          "description": "Nivel educativo requerido"
        },
        "idiomas": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Idiomas requeridos"
        },
        "habilidades": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Habilidades/skills mencionadas"
        },
        "certificaciones": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Certificaciones requeridas"
        }
      }
    },

    "compensacion": {
      "type": "object",
      "description": "Información de compensación",
      "properties": {
        "salario_minimo": {
          "type": "number",
          "description": "Salario mínimo"
        },
        "salario_maximo": {
          "type": "number",
          "description": "Salario máximo"
        },
        "moneda": {
          "type": "string",
          "description": "Moneda del salario"
        },
        "periodo": {
          "type": "string",
          "enum": ["hora", "dia", "semana", "mes", "año", null],
          "description": "Período del salario"
        },
        "salario_raw": {
          "type": "string",
          "description": "Salario tal como aparece en la fuente"
        },
        "beneficios": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Beneficios mencionados"
        }
      }
    },

    "detalles": {
      "type": "object",
      "description": "Detalles adicionales",
      "properties": {
        "cantidad_vacantes": {
          "type": "integer",
          "description": "Número de vacantes"
        },
        "area_trabajo": {
          "type": "string",
          "description": "Área de trabajo"
        },
        "nivel_puesto": {
          "type": "string",
          "description": "Nivel del puesto (junior, semi-senior, senior, etc.)"
        },
        "apto_discapacitado": {
          "type": "boolean",
          "description": "Si es apto para personas con discapacidad"
        },
        "confidencial": {
          "type": "boolean",
          "description": "Si la empresa es confidencial"
        }
      }
    },

    "clasificacion_esco": {
      "type": "object",
      "description": "Clasificación ESCO (añadida en etapa 03_esco_matching)",
      "properties": {
        "ocupacion_esco_code": {
          "type": "string",
          "description": "Código ESCO de la ocupación"
        },
        "ocupacion_esco_label": {
          "type": "string",
          "description": "Etiqueta de la ocupación ESCO"
        },
        "isco_code": {
          "type": "string",
          "description": "Código ISCO-08"
        },
        "isco_label": {
          "type": "string",
          "description": "Etiqueta ISCO-08"
        },
        "similarity_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Score de similitud del matching"
        },
        "skills": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "skill_uri": {"type": "string"},
              "skill_label": {"type": "string"},
              "skill_type": {"type": "string", "enum": ["essential", "optional"]}
            }
          },
          "description": "Skills asociadas de ESCO"
        },
        "matching_method": {
          "type": "string",
          "description": "Método usado para el matching"
        },
        "matching_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp del matching"
        }
      }
    },

    "source_specific": {
      "type": "object",
      "description": "Campos específicos de cada fuente (no normalizados)",
      "additionalProperties": true
    }
  }
}
